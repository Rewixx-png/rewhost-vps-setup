#!/bin/bash

# ==============================================================================
#      RewHost - –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ VPS
# ==============================================================================
#   –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥—É–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
#   –∏–∑ –ø–∞–ø–∫–∏ /scripts –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.
# ==============================================================================

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –æ—Ç –∏–º–µ–Ω–∏ root
if [ "$(id -u)" -ne 0 ]; then
    echo -e "\n\e[1;31m–û—à–∏–±–∫–∞: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç –∏–º–µ–Ω–∏ root –∏–ª–∏ —Å –ø–æ–º–æ—â—å—é sudo.\e[0m\n"
    exit 1
fi

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏
SCRIPTS_DIR="$(dirname "$0")/scripts"

# --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ ---
print_step() {
    echo -e "\n\e[1;34m[ –®–∞–≥: $1 ]\e[0m"
}
print_info() {
    echo -e "\e[32m ‚úì $1\e[0m"
}
print_error() {
    echo -e "\e[1;31m ‚ùå –û–®–ò–ë–ö–ê: $1\e[0m"
}
check_status() {
    if [ $? -ne 0 ]; then
        print_error "$1 –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å. –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞."
        exit 1
    fi
}

# --- –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ ---
main() {
    clear
    echo -e "\e[1;35müöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –Ω–æ–≤–æ–≥–æ VPS –¥–ª—è RewHost...\e[0m"

    print_step "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä—É—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã"
    print_info "–ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–¥—É–ª—å 01-system.sh..."
    bash "$SCRIPTS_DIR/01-system.sh"
    check_status "–ù–∞ —ç—Ç–∞–ø–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —Ä—É—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã."
    print_info "–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ —Ä—É—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞."

    print_step "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ü–û"
    print_info "–ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–¥—É–ª—å 02-software.sh..."
    bash "$SCRIPTS_DIR/02-software.sh"
    check_status "–ù–∞ —ç—Ç–∞–ø–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º."
    print_info "–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ."

    print_step "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (MOTD)"
    print_info "–ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–¥—É–ª—å 03-motd.sh..."
    bash "$SCRIPTS_DIR/03-motd.sh"
    check_status "–ù–∞ —ç—Ç–∞–ø–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MOTD."
    print_info "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ."

    print_step "–°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤"
    print_info "–ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–¥—É–ª—å 04-docker-images.sh... –≠—Ç–æ —Å–∞–º—ã–π –¥–æ–ª–≥–∏–π —à–∞–≥."
    bash "$SCRIPTS_DIR/04-docker-images.sh"
    check_status "–ù–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–æ–≤."
    print_info "–í—Å–µ Docker-–æ–±—Ä–∞–∑—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω—ã."

    # --- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ ---
    echo -e "\n\e[1;32m=====================================================\e[0m"
    echo -e "\e[1;32m   ‚úÖ –°–ï–†–í–ï–† –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï! ‚úÖ\e[0m"
    echo -e "\e[1;32m=====================================================\e[0m"
    echo ""
    echo -e "  \e[1m–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:\e[0m"
    echo "  - –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏."
    echo "  - –í—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä—É—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã."
    echo "  - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: Docker, Nginx, UFW, Git, Python."
    echo "  - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Fastfetch –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞."
    echo "  - –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—ã–≤–æ–¥–æ–º –Ω–∞–≥—Ä—É–∑–∫–∏."
    echo "  - –°–æ–±—Ä–∞–Ω—ã Docker-–æ–±—Ä–∞–∑—ã: hikka, heroku, topkasoso."
    echo ""
    echo -e "  \e[33m–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.\e[0m"
    echo ""
}

# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
main